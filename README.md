#  1 定时器基本介绍
##  1.1 STM32定时器
简单来说就是用来定时的机器，是存在于STM32单片机中的一个外设。
STM32总共有8个定时器，分别是2个高级定时器（TIM1、TIM8），4个通用定时器（TIM2、TIM3、TIM4、TIM5）和2个基本定时器（TIM5、TIM6），如下表所示：

|定时器名称| 功能等级 |
|--|--|
| TIM1 | 高级控制定时器 |
|TIM8|高级控制定时器
|TIM2|通用定时器
|TIM3|通用定时器
|TIM4|通用定时器|
|TIM5|通用定时器
|TIM6|基本定时器
|TIM7|基本定时器

这三种定时器的区别如下：
|定时器种类|位数|计数器模式|产生DMA请求|捕获/比较通道|互补输出|
|--|--|--|--|--|--|
|高级定时器|16|向上，向下，向上/下|可以|4|有
|通用定时器|16|向上，向下，向上/下|可以|4|无
|基本定时器|16|向上，向下，向上/下|可以|0|无

**即：高级定时器具有捕获/比较通道和互补输出，通用定时器只有捕获/比较通道，基本定时器没有以上两者。**

## 1.2 通用定时器功能和特点
STM32的众多定时器中我们使用最多的是高级定时器和通用定时器，而高级定时器一般也是用作通用定时器的功能，下面我们就以通用定时器为例进行讲解，其功能和特点包括：

- 位于低速的APB1总线上(APB1)
- 16 位向上、向下、向上/向下(中心对齐)计数模式，自动装载计数器（TIMx_CNT）。
- 16 位可编程(可以实时修改)预分频器(TIMx_PSC)，计数器时钟频率的分频系数 为 1～65535 之间的任意数值。
- 4 个独立通道（TIMx_CH1~4），这些通道可以用来作为：
	① 输入捕获
	② 输出比较
	③ PWM生成（边缘或中间对齐模式）
	④ 单脉冲模式输出
- 可使用外部信号（TIMx_ETR）控制定时器和定时器互连（可以用 1 个定时器控制另外一个定时器）的同步电路。
- 如下事件发生时产生中断/DMA（6个独立的IRQ/DMA请求生成器）： 
①更新：计数器向上溢出/向下溢出，计数器初始化(通过软件或者内部/外部触发) 

 	②触发事件(计数器启动、停止、初始化或者由内部/外部触发计数) 

	 ③输入捕获 

 	④输出比较 

 	⑤支持针对定位的增量(正交)编码器和霍尔传感器电路 

   ⑥触发输入作为外部时钟或者按周期的电流管理

- STM32 的通用定时器可以被用于：测量输入信号的脉冲长度(输入捕获)或者产生输出波形(输出比较和 PWM)等。
- 使用定时器预分频器和 RCC 时钟控制器预分频器，脉冲长度和波形周期可以在几个微秒到几个毫秒间调整。STM32 的每个通用定时器都是完全独立的，没有互相共享的任何资源。

## 1.3 计数器模式
通用定时器可以向上计数、向下计数、向上向下双向计数模式。

1. 向上计数模式：计数器从0计数到自动加载值(TIMx_ARR)，然后重新从0开始计数并且产生一个计数器溢出事件。

2. 向下计数模式：计数器从自动装入的值(TIMx_ARR)开始向下计数到0，然后从自动装入的值重新开始，并产生一个计数器向下溢出事件。

3. 中央对齐模式（向上/向下计数）：计数器从0开始计数到自动装入的值-1，产生一个计数器溢出事件，然后向下计数到1并且产生一个计数器溢出事件；然后再从0开始重新计数。
